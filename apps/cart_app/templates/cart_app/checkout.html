{% extends 'templates/base.html' %}
{% load humanize %}

{% block header %}
    <meta name="description" content="فروشگاه تجهیزات الکترونیکی پرایم سیستم، فروش انواع تجهیرات الکترونیک اعم از کیس و کیبورد و مانیتور نو و استوک و دست دوم"/>
    <meta name="robots" content="index, follow" />
    <meta name="canonical" content="https://prime-system.ir/cart/checkout, https://www.prime-system.ir/cart/checkout" />
    <meta name="keywords" content="پرایم سیستم, prime system, فروشگاه آنلاین پرایم سیستم, خرید تجهیزات الکترونیک,استوک و نو, فروش لپ‌تاپ, فروش قطعات کامپیوتر, پیکربندی شبکه,اسمبل سیستم"/>
    <title>تکمیل سفارش</title>
{% endblock %}

{% block main %}
    <!-- start main-data -->
    <div class="content">
        <div class="container-fluid">
            <div class="content-box">
                <style>
                    .line-step-box.complete:nth-child(1):before {
                        width: 100%;
                    }
                </style>
                <div class="line-step-container d-sm-block d-none">
                    <div class="line-step">
                        <div class="line-step-boxs">
                            <div class="line-step-box complete">
                                <div class="icon">
                                    <i class="bi bi-bag"></i>
                                </div>
                                <p>سبد خرید</p>
                            </div>
                            <div class="line-step-box complete">
                                <div class="icon">
                                    <i class="bi bi-file-earmark-text"></i>
                                </div>
                                <p>جزییات پرداخت</p>
                            </div>
                            <div class="line-step-box disabled">
                                <div class="icon">
                                    <i class="bi bi-file-earmark-break"></i>
                                </div>
                                <p>تکمیل سفارش</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="checkout-content">
                    <div class="checkout-form-parent mt-5">
                        <div class="row">
                            <div class="col-lg-8">
                                <div class="checkout-forms">
                                    <div class="checkout-form-title">
                                        <h5 class="font-18 mb-3 slider-title def-color">جزییات پرداخت</h5>
                                    </div>
                                    <div class="checkout-form">
                                        <form action="{% url 'cart:checkout' %}" method="post">
                                            {% csrf_token %}
                                            {% if field %}
                                                <script>
                                                    document.addEventListener('DOMContentLoaded', () => {
                                                        Swal.fire({
                                                            icon: 'error',
                                                            title: '{{ field|escapejs }}',
                                                            text: '{{ error_message|escapejs }}',
                                                            confirmButtonColor: '#3085d6',
                                                        });
                                                    });
                                                </script>
                                            {% endif %}
                                            <div class="form-group">
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <div class="form-floating mb-3">
                                                            {{ form.first_name }}
                                                            <label for="floatingInputFname">نام</label>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <div class="form-floating mb-3">
                                                            {{ form.last_name }}
                                                            <label for="floatingInputLname">نام خانوادگی</label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <div class="form-floating mb-3">
                                                            {{ form.phone }}
                                                            <label for="phone">شماره تلفن همراه</label>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <div class="form-floating mb-3">
                                                            {{ form.email }}
                                                            <label for="email">آدرس ایمیل (اختیاری)</label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <div class="form-floating mb-3">
                                                            {{ form.state }}
                                                            <label for="state">استان</label>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <div class="form-floating mb-3">
                                                            {{ form.postal_code }}
                                                            <label for="postal_code">کد پستی (اختیاری)</label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-floating mb-3">
                                                {{ form.address }}
                                                <label for="floatingInputStreet">آدرس خود را کامل وارد کنید</label>
                                            </div>
                                            <div class="form-floating mb-3">
                                                {{ form.note }}
                                                <label for="floatingInputDesc">نکاتی درباره سفارش را که لازم است یادداشت کنید</label>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <div class="checkout-payment">
                                    <div class="title text-center">
                                        <h4 class="fw-bold slider-title def-color">مجموع کل سبد خرید</h4>
                                    </div>
                                    <table class="table main-table table-striped text-center">
                                        <tr>
                                            <th class="pb-3">محصول</th>
                                            <th class="pb-3">قیمت کل</th>
                                        </tr>
                                        {% for item in cart %}
                                        <tr>
                                            <td class="fw-bold">{{ item.product.name }}</td>
                                            <td class="txt">
                                                <span class="fw-bold">{{ item.total|intcomma:False }}</span> <span class="text-muted font-10">تومان</span>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                        <tr>
                                            <td class="fw-bold">حمل و نقل</td>
                                            <td class="txt">
                                                <span class="fw-bold">برعهده خریدار</span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="fw-bold">مجموع</td>
                                            <td class="txt">
                                                <span class="fw-bold">{{ cart.total|intcomma:False }}</span> <span class="text-muted font-10">تومان</span>
                                            </td>
                                        </tr>
                                    </table>

                                    <div class="checkout-bank mt-3">
                                        <div class="item-box">
                                            <div class="title">
                                                <h4 class="font-16">
                                                    انتخاب درگاه
                                                </h4>
                                            </div>
                                            <div class="desc">
                                                <div class="form-group form-check">
                                                    <input class="form-check-input" type="radio" id="bankOne" checked name="available">
                                                    <label class="form-check-label" for="bankOne">بانک تجارت</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                     <button id="submit-btn" class="btn border-0 w-100 main-color-one-bg waves-effect waves-light py-3">اقدام به پرداخت <i class="bi bi-suit-heart"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- end main-data -->
    <script>
        let form = document.querySelector('.checkout-form form');
        let submitBtn = document.getElementById('submit-btn');
        let firstNameInput = form.querySelector('#floatingInputFname');
        let lastNameInput = form.querySelector('#floatingInputLname');
        let phoneInput = form.querySelector('#phone');
        let stateInput = form.querySelector('#state');
        let addressInput = form.querySelector('#floatingInputStreet');

        let importantInputs = []
        importantInputs.push(firstNameInput, lastNameInput, phoneInput, stateInput, addressInput);

        function checkInputsValue(){
            for (let input of importantInputs) {
                if (!input.value) {
                    input.scrollIntoView({behavior: "smooth", block: "start", inline: "nearest"});
                    input.focus();
                    return false;
                }
            }
            return true;
        }

        submitBtn.addEventListener('click', () => {
            let inputsHasValue = checkInputsValue();
            if (inputsHasValue) {
                form.submit()
            }
        })
    </script>
{% endblock %}