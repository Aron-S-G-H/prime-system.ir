{% extends 'templates/base.html' %}

{% block header %}
    <meta name="description" content="صفحه تائید کد فراموشی رمز عبور کاربر در وبسایت فروشگاهی تجهیزات الکترونیک پرایم سیستم"/>
    <meta name="robots" content="noindex, nofollow" />
    <meta name="keywords" content="پرایم سیستم, prime system, فروشگاه آنلاین پرایم سیستم, خرید تجهیزات الکترونیک,استوک و نو, فروش لپ‌تاپ, فروش قطعات کامپیوتر, prime system shop"/>
    <title>تائید کد</title>
{% endblock %}

{% block main %}
    <!-- bread croumb -->
    <div class="content">
        <div class="container-fluid">
            <nav aria-label="breadcrumb" class="my-lg-0 my-2">
                <ol class="breadcrumb mb-0">
                    <li class="breadcrumb-item"><a href="{% url 'main:Home_page' %}" class="font-14 text-muted">خانه</a></li>
                    <li class="breadcrumb-item active main-color-one-color font-14" aria-current="page">تائید کد فراموشی رمز</li>
                </ol>
            </nav>
        </div>
    </div>

    <!-- start main-data -->
    <div class="content">
        <div class="container-fluid">
            <div class="content-box">
                <div class="row justify-content-center">
                    <div class="col-lg-6 col-xl-4 col-sm-8">
                        <div class="auth shadow-box rounded-4 p-4">
                            <div class="auth-content">
                                <h3 class="font-16 text-center forget-title-form" style="padding-top:70px;">لطفا کدی که
                                    برای شما ایمیل شده را وارد کنید</h3>
                                <form id="code-form" class="mt-3">
                                    <div class="form-floating mb-3">
                                        <input type="text" required class="form-control float-input text-center send-code-input" id="floatingInput" placeholder="برای مثال 45222">
                                        <label for="floatingInput">برای مثال 45222</label>
                                    </div>
                                    <div class="form-group">
                                        <button class="btn main-color-three-bg border-0 rounded-pill w-100 text-white waves-effect waves-light">تائید</button>
                                    </div>
                                </form>
                                <div class="divider">
                                    <span>یا</span>
                                </div>
                                <div class="d-flex justify-content-center">
                                    <a href="{% url 'account:login' %}">حساب کاربری دارم ! ورود به فروشگاه</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- end main-data -->

    <script>
        const codeForm = document.getElementById('code-form');
        const codeInput = codeForm.querySelector('input');
        const submitBtn = codeForm.querySelector('button');
        submitBtn.addEventListener('click', event => {
            event.preventDefault();
            if (codeInput.value) {
                codeInput.disabled = true; submitBtn.disabled = true;
                $.ajax({
                    url: '{% url "account:verify_forget_password" %}',
                    type: 'POST',
                    data: {'code': codeInput.value},
                    beforeSend: function (xhr) {
                        xhr.setRequestHeader('X-CSRFToken', '{{ csrf_token }}');
                    },
                    success: function (response) {
                        if (response.status === 400) {
                            Swal.fire({
                                icon: 'error',
                                title: 'خطای ۴۰۰',
                                text: `${response.message}`,
                                confirmButtonColor: '#3085d6',
                            })
                        }
                        else if (response.status === 200){
                            Swal.fire({
                                position: 'top-start',
                                icon: 'success',
                                title: `${response.first_name} ${response.last_name} خوش آمدی `,
                                showConfirmButton: false,
                                timer: 1500
                            }).then(() => {
                                window.location.assign('/')
                            })
                        }
                        codeInput.disabled = false; submitBtn.disabled = false;
                    },
                    error: function (error) {
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: 'خطایی رخ داده است! وضعیت اینترنت خود را بررسی کنید و دوباره امتحان کنید. در صورت برطرف نشدن مشکل با پشتیبانی تماس بگیرید.',
                            confirmButtonColor: '#3085d6',
                        })
                        console.log(error)
                        codeInput.disabled = false; submitBtn.disabled = false;
                    },
                })
            } else {
                codeInput.focus();
            }
        })
    </script>
{% endblock %}
